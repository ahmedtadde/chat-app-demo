"use strict";!function(){var e=io.connect("http://127.0.0.1:5000"),s=["input","submit","output","refresh","exit","username","signin","signin-btn","users"],t=function(e){var s={};return e.forEach(function(e){s[e]=document.getElementById(e)}),s},n=function(e,s){var t=document.createElement(e);return s.forEach(function(e){t.setAttribute(e[0],e[1])}),t},u=function(e){var s=n("div",[["class","user"]]);s.setAttribute("data-user",e);var t=n("img",[["class","user_icon"],["src","assets/user-icon.png"]]),u=n("span",[["class","user_name"]]);u.textContent=e,s.appendChild(t),s.appendChild(u),r.users.appendChild(s)},i=function(){var s=r.username.value;s&&(r.username.value="",r.input.setAttribute("data-user",s),r.signin.classList.add("hidden"),r.users.classList.remove("hidden"),r.input.classList.remove("hidden"),e.emit("new user",{user:s}),e.emit("new message",{user:s,message:"joined the chat..."}))},a=function(){var s=r.input.getAttribute("data-user");s&&(e.emit("save message",{user:s,message:r.input.value}),r.input.value="")},r=t(s,n),o=[];e&&(r.username.onkeypress=function(e){var s=e.keyCode||e.which;13!==s||e.shiftKey||i()},r["signin-btn"].onclick=function(){i()},r.input.onkeypress=function(e){var s=e.keyCode||e.which;13!==s||e.shiftKey||a()},r.submit.onclick=function(){a()},r.refresh.onclick=function(){r.username.value="",r.input.value="",r.output.innerHTML=""},r.exit.onclick=function(){var s=r.input.getAttribute("data-user");s&&(r.users.classList.add("hidden"),r.username.value="",r.signin.classList.remove("hidden"),r.input.classList.add("hidden"),r.input.value="",r.input.setAttribute("data-user",""),e.emit("new message",{user:s,message:"left the chat...",user_left:!0}),e.emit("user left",{user:s}),r.users.innerHTML="",o=[])},e.on("load messages",function(e){e.length&&e.forEach(function(e){var s=void 0,t=void 0,u=void 0;s=n("div",[["class","users-message"]]),t=n("span",[["class","users-message_from"]]),u=n("p",[["class","users-message_text"]]),t.textContent=e.user,u.textContent=e.message,s.appendChild(t),s.appendChild(u),r.output.appendChild(s)})}),e.on("new user",function(e){o.includes(e.user.toLowerCase())||(u(e.user),o.push(e.user.toLowerCase()))}),e.on("user left",function(e){o.includes(e.user.toLowerCase())&&(r.users.querySelector('.user[data-user="'+e.user+'"]').remove(),o.pop(e.user.toLowerCase()))}),e.on("message saved",function(s){e.emit("new message",s)}),e.on("new message",function(s){if(s){"undefined"==typeof s.user_left&&e.emit("new user",{user:s.user});var t=r.input.getAttribute("data-user")===s.user,u=void 0,i=void 0,a=void 0;t?(u=n("div",[["class","user-message"]]),i=n("span",[["class","user-message_from"]]),a=n("p",[["class","user-message_text"]])):(u=n("div",[["class","users-message"]]),i=n("span",[["class","users-message_from"]]),a=n("p",[["class","users-message_text"]])),i.textContent=s.user,a.textContent=s.message,u.appendChild(i),u.appendChild(a),r.output.appendChild(u),r.input.value=""}}))}();