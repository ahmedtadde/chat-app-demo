"use strict";!function(){var e=io(),s=["input","submit","output","refresh","exit","username","signin","signin-btn","users"],t=function(e){var s={};return e.forEach(function(e){s[e]=document.getElementById(e)}),s},n=function(e,s){var t=document.createElement(e);return s.forEach(function(e){t.setAttribute(e[0],e[1])}),t},u=function(e){var s=n("div",[["class","user"]]);s.setAttribute("data-user",e);var t=n("img",[["class","user_icon"],["src","assets/user-icon.png"]]),u=n("span",[["class","user_name"]]);u.textContent=e,s.appendChild(t),s.appendChild(u),o.users.appendChild(s)},i=function(){var s=o.username.value;s&&(o.username.value="",o.input.setAttribute("data-user",s),o.signin.classList.add("hidden"),o.users.classList.remove("hidden"),o.input.classList.remove("hidden"),e.emit("new user",{user:s}),e.emit("new message",{user:s,message:"joined the chat..."}))},a=function(){var s=o.input.getAttribute("data-user");s&&(e.emit("save message",{user:s,message:o.input.value}),o.input.value="")},r=function(){o.output.scrollTop=o.output.scrollHeight-o.output.clientHeight},o=t(s,n),c=[];e&&(o.username.onkeypress=function(e){var s=e.keyCode||e.which;13!==s||e.shiftKey||i()},o["signin-btn"].onclick=function(){i()},o.input.onkeypress=function(e){var s=e.keyCode||e.which;13!==s||e.shiftKey||a()},o.submit.onclick=function(){a()},o.refresh.onclick=function(){o.username.value="",o.input.value="",o.output.innerHTML=""},o.exit.onclick=function(){var s=o.input.getAttribute("data-user");s&&(o.users.classList.add("hidden"),o.username.value="",o.signin.classList.remove("hidden"),o.input.classList.add("hidden"),o.input.value="",o.input.setAttribute("data-user",""),e.emit("new message",{user:s,message:"left the chat...",user_left:!0}),e.emit("user left",{user:s}),o.users.innerHTML="",c=[])},window.onpopstate=function(){o.exit.click()},window.onbeforeunload=function(){o.exit.click()},e.on("load messages",function(e){e.length&&(e.forEach(function(e){var s=void 0,t=void 0,u=void 0;s=n("div",[["class","users-message"]]),t=n("span",[["class","users-message_from"]]),u=n("p",[["class","users-message_text"]]),t.textContent=e.user,u.textContent=e.message,s.appendChild(t),s.appendChild(u),o.output.appendChild(s)}),r())}),e.on("new user",function(e){c.includes(e.user.toLowerCase())||(u(e.user),c.push(e.user.toLowerCase()))}),e.on("user left",function(e){c.includes(e.user.toLowerCase())&&(o.users.querySelector('.user[data-user="'+e.user+'"]').remove(),c.pop(e.user.toLowerCase()))}),e.on("message saved",function(s){e.emit("new message",s)}),e.on("new message",function(s){if(s){"undefined"==typeof s.user_left&&e.emit("new user",{user:s.user});var t=o.input.getAttribute("data-user")===s.user,u=void 0,i=void 0,a=void 0;t?(u=n("div",[["class","user-message"]]),i=n("span",[["class","user-message_from"]]),a=n("p",[["class","user-message_text"]])):(u=n("div",[["class","users-message"]]),i=n("span",[["class","users-message_from"]]),a=n("p",[["class","users-message_text"]])),i.textContent=s.user,a.textContent=s.message,u.appendChild(i),u.appendChild(a),o.output.appendChild(u),o.input.value="",r()}}))}();